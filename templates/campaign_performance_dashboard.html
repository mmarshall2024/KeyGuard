<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Performance Dashboard - OMNI Empire</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            padding: 40px 0;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.15);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .metric-trend {
            font-size: 0.8rem;
            margin-top: 10px;
        }
        .trend-up { color: #28a745; }
        .trend-down { color: #dc3545; }
        .trend-stable { color: #6c757d; }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .performance-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        
        .table th {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px;
        }
        
        .table td {
            padding: 15px;
            vertical-align: middle;
            border-bottom: 1px solid #dee2e6;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-active { background: #d4edda; color: #155724; }
        .status-paused { background: #fff3cd; color: #856404; }
        .status-completed { background: #d1ecf1; color: #0c5460; }
        
        .performance-score {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        .score-excellent { background: #28a745; }
        .score-good { background: #17a2b8; }
        .score-average { background: #ffc107; color: #333; }
        .score-poor { background: #dc3545; }
        
        .progress-bar-custom {
            height: 8px;
            border-radius: 4px;
        }
        
        .channel-performance {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .channel-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }
        
        .prediction-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .recommendation-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .rec-urgent { border-left-color: #dc3545; }
        .rec-warning { border-left-color: #ffc107; }
        .rec-success { border-left-color: #28a745; }
        .rec-info { border-left-color: #17a2b8; }
        
        .real-time-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        .auto-refresh {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        .filter-controls {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .btn-filter {
            margin: 5px;
            border-radius: 20px;
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            transition: all 0.3s ease;
        }
        .btn-filter.active, .btn-filter:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Auto-refresh Indicator -->
    <div class="auto-refresh">
        <span class="real-time-indicator"></span>
        Auto-refreshing every 30s
    </div>

    <!-- Dashboard Header -->
    <section class="dashboard-header text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-chart-line me-3"></i>Campaign Performance Dashboard
            </h1>
            <p class="lead mb-4">Real-Time Analytics • Predictive Intelligence • Performance Optimization</p>
            <div class="row">
                <div class="col-md-4">
                    <div class="h5">Live Monitoring</div>
                    <small>30-second updates</small>
                </div>
                <div class="col-md-4">
                    <div class="h5">AI Predictions</div>
                    <small>Advanced forecasting</small>
                </div>
                <div class="col-md-4">
                    <div class="h5">Smart Optimization</div>
                    <small>Automated recommendations</small>
                </div>
            </div>
        </div>
    </section>

    <div class="container-fluid py-4">
        <!-- Filter Controls -->
        <div class="filter-controls">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h6 class="mb-2">Campaign Filters:</h6>
                    <button class="btn btn-filter active" onclick="filterCampaigns('all')">All Campaigns</button>
                    <button class="btn btn-filter" onclick="filterCampaigns('active')">Active Only</button>
                    <button class="btn btn-filter" onclick="filterCampaigns('high-roi')">High ROI</button>
                    <button class="btn btn-filter" onclick="filterCampaigns('top-performing')">Top Performing</button>
                </div>
                <div class="col-md-6 text-end">
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="fas fa-download me-2"></i>Export Data
                    </button>
                    <button class="btn btn-success" onclick="refreshDashboard()">
                        <i class="fas fa-sync me-2"></i>Refresh Now
                    </button>
                </div>
            </div>
        </div>

        <!-- Key Metrics Row -->
        <div class="row">
            <div class="col-lg-3 col-md-6">
                <div class="metric-card">
                    <div class="metric-value" id="totalRevenue">$0</div>
                    <div class="metric-label">Total Revenue</div>
                    <div class="metric-trend trend-up" id="revenueTrend">
                        <i class="fas fa-arrow-up"></i> +24% from yesterday
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card">
                    <div class="metric-value" id="avgConversionRate">0%</div>
                    <div class="metric-label">Avg Conversion Rate</div>
                    <div class="metric-trend trend-up" id="conversionTrend">
                        <i class="fas fa-arrow-up"></i> +12% improvement
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card">
                    <div class="metric-value" id="avgROI">0x</div>
                    <div class="metric-label">Average ROI</div>
                    <div class="metric-trend trend-up" id="roiTrend">
                        <i class="fas fa-arrow-up"></i> +18% increase
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="metric-card">
                    <div class="metric-value" id="activeCampaigns">0</div>
                    <div class="metric-label">Active Campaigns</div>
                    <div class="metric-trend trend-stable" id="campaignsTrend">
                        <i class="fas fa-minus"></i> Stable
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="row">
            <!-- Revenue Trends Chart -->
            <div class="col-lg-8">
                <div class="chart-container">
                    <h5 class="mb-4"><i class="fas fa-chart-area me-2"></i>Revenue Trends (24 Hours)</h5>
                    <canvas id="revenueChart" height="100"></canvas>
                </div>
            </div>
            
            <!-- Channel Performance Pie Chart -->
            <div class="col-lg-4">
                <div class="chart-container">
                    <h5 class="mb-4"><i class="fas fa-chart-pie me-2"></i>Channel Performance</h5>
                    <canvas id="channelChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Campaign Performance Table -->
        <div class="row">
            <div class="col-12">
                <div class="performance-table">
                    <h5 class="p-3 mb-0 bg-gradient text-white">
                        <i class="fas fa-table me-2"></i>Campaign Performance Comparison
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="campaignTable">
                            <thead>
                                <tr>
                                    <th>Campaign</th>
                                    <th>Status</th>
                                    <th>Revenue</th>
                                    <th>Progress</th>
                                    <th>Conversions</th>
                                    <th>ROI</th>
                                    <th>Score</th>
                                    <th>Time Left</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="campaignTableBody">
                                <tr>
                                    <td colspan="9" class="text-center py-4">Loading campaign data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Channel Performance and Predictions Row -->
        <div class="row">
            <!-- Channel Performance -->
            <div class="col-lg-6">
                <div class="channel-performance">
                    <h5 class="mb-4"><i class="fas fa-broadcast-tower me-2"></i>Channel Performance Analysis</h5>
                    <div id="channelPerformanceList">
                        <div class="text-center py-4">Loading channel data...</div>
                    </div>
                </div>
            </div>
            
            <!-- Predictive Analytics -->
            <div class="col-lg-6">
                <div class="prediction-card">
                    <h5 class="mb-4"><i class="fas fa-crystal-ball me-2"></i>Predictive Analytics</h5>
                    
                    <div class="mb-4">
                        <h6>Revenue Forecast</h6>
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="h4" id="forecast24h">$0</div>
                                <small>Next 24h</small>
                            </div>
                            <div class="col-4">
                                <div class="h4" id="forecast7d">$0</div>
                                <small>Next 7 days</small>
                            </div>
                            <div class="col-4">
                                <div class="h4" id="forecast30d">$0</div>
                                <small>Next 30 days</small>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h6>Market Opportunities</h6>
                        <div id="marketOpportunities">
                            <div class="text-center py-3">Loading predictions...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recommendations Section -->
        <div class="row">
            <div class="col-12">
                <div class="chart-container">
                    <h5 class="mb-4"><i class="fas fa-lightbulb me-2"></i>Smart Recommendations</h5>
                    <div id="recommendationsList">
                        <div class="text-center py-4">Loading recommendations...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let dashboardData = {};
        let revenueChart, channelChart;
        let refreshInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            startAutoRefresh();
        });
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/dashboard-data');
                dashboardData = await response.json();
                
                updateMetrics();
                updateCharts();
                updateCampaignTable();
                updateChannelPerformance();
                updatePredictiveAnalytics();
                updateRecommendations();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading dashboard data', 'error');
            }
        }
        
        // Update key metrics
        function updateMetrics() {
            const metrics = dashboardData.dashboard_metrics;
            
            document.getElementById('totalRevenue').textContent = 
                '$' + Math.round(metrics.real_time_revenue || 0).toLocaleString();
            
            document.getElementById('avgConversionRate').textContent = 
                (metrics.conversion_rate || 0).toFixed(1) + '%';
            
            document.getElementById('avgROI').textContent = 
                (metrics.roi_performance || 0).toFixed(1) + 'x';
            
            document.getElementById('activeCampaigns').textContent = 
                Object.keys(dashboardData.active_campaigns || {}).length;
        }
        
        // Update charts
        function updateCharts() {
            updateRevenueChart();
            updateChannelChart();
        }
        
        // Update revenue trends chart
        function updateRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            const hourlyData = dashboardData.dashboard_metrics.hourly_trends || [];
            
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hourlyData.map(d => d.hour),
                    datasets: [{
                        label: 'Revenue',
                        data: hourlyData.map(d => d.revenue),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'ROI',
                        data: hourlyData.map(d => d.roi),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        fill: false,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }
        
        // Update channel performance chart
        function updateChannelChart() {
            const ctx = document.getElementById('channelChart').getContext('2d');
            const channelData = dashboardData.dashboard_metrics.channel_performance || {};
            
            if (channelChart) {
                channelChart.destroy();
            }
            
            const channels = Object.keys(channelData);
            const revenues = channels.map(ch => channelData[ch].revenue || 0);
            
            channelChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: channels,
                    datasets: [{
                        data: revenues,
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#28a745',
                            '#ffc107',
                            '#17a2b8'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }
        
        // Update campaign table
        function updateCampaignTable() {
            const tbody = document.getElementById('campaignTableBody');
            const campaigns = dashboardData.dashboard_metrics.campaign_comparisons || [];
            
            if (campaigns.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="text-center py-4">No active campaigns</td></tr>';
                return;
            }
            
            const html = campaigns.map(campaign => {
                const statusClass = campaign.status === 'active' ? 'status-active' : 
                                  campaign.status === 'paused' ? 'status-paused' : 'status-completed';
                
                const scoreClass = campaign.overall_score >= 80 ? 'score-excellent' :
                                 campaign.overall_score >= 60 ? 'score-good' :
                                 campaign.overall_score >= 40 ? 'score-average' : 'score-poor';
                
                return `
                    <tr>
                        <td>
                            <strong>${campaign.name}</strong><br>
                            <small class="text-muted">${campaign.type}</small>
                        </td>
                        <td>
                            <span class="status-badge ${statusClass}">${campaign.status}</span>
                        </td>
                        <td>
                            <strong>$${Math.round(campaign.revenue).toLocaleString()}</strong><br>
                            <small class="text-muted">Target: $${Math.round(campaign.target_revenue).toLocaleString()}</small>
                        </td>
                        <td>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: ${Math.min(100, campaign.revenue_progress)}%"></div>
                            </div>
                            <small>${Math.round(campaign.revenue_progress)}%</small>
                        </td>
                        <td>
                            <strong>${campaign.conversions}</strong><br>
                            <small class="text-muted">Target: ${campaign.target_conversions}</small>
                        </td>
                        <td>
                            <strong>${campaign.roi.toFixed(1)}x</strong>
                        </td>
                        <td>
                            <div class="performance-score ${scoreClass}">
                                ${Math.round(campaign.overall_score)}
                            </div>
                        </td>
                        <td>${campaign.duration_remaining}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="viewCampaignDetails('${campaign.campaign_id}')">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="optimizeCampaign('${campaign.campaign_id}')">
                                <i class="fas fa-cog"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tbody.innerHTML = html;
        }
        
        // Update channel performance
        function updateChannelPerformance() {
            const container = document.getElementById('channelPerformanceList');
            const channels = dashboardData.dashboard_metrics.channel_performance || {};
            
            if (Object.keys(channels).length === 0) {
                container.innerHTML = '<div class="text-center py-4">No channel data available</div>';
                return;
            }
            
            const html = Object.entries(channels).map(([channel, data]) => `
                <div class="channel-item">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-capitalize">${channel}</h6>
                            <small class="text-muted">${data.campaigns || 0} campaigns</small>
                        </div>
                        <div class="col-md-6">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="fw-bold">$${Math.round(data.revenue || 0).toLocaleString()}</div>
                                    <small>Revenue</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold">${(data.conversion_rate || 0).toFixed(1)}%</div>
                                    <small>CVR</small>
                                </div>
                                <div class="col-4">
                                    <div class="fw-bold">${Math.round(data.efficiency_score || 0)}</div>
                                    <small>Score</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Update predictive analytics
        function updatePredictiveAnalytics() {
            const predictions = dashboardData.dashboard_metrics.predictive_analytics || {};
            const forecast = predictions.revenue_forecast || {};
            
            document.getElementById('forecast24h').textContent = '$' + (forecast['24_hours'] || 0).toLocaleString();
            document.getElementById('forecast7d').textContent = '$' + (forecast['7_days'] || 0).toLocaleString();
            document.getElementById('forecast30d').textContent = '$' + (forecast['30_days'] || 0).toLocaleString();
            
            // Update market opportunities
            const opportunities = predictions.market_opportunities || [];
            const opportunitiesHtml = opportunities.map(opp => `
                <div class="mb-3 p-3 bg-light rounded">
                    <h6>${opp.opportunity}</h6>
                    <div class="row">
                        <div class="col-6">
                            <strong>$${Math.round(opp.potential_revenue).toLocaleString()}</strong>
                            <small class="d-block">Potential Revenue</small>
                        </div>
                        <div class="col-6">
                            <strong>${Math.round(opp.confidence * 100)}%</strong>
                            <small class="d-block">Confidence</small>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('marketOpportunities').innerHTML = opportunitiesHtml || 
                '<div class="text-center py-3">No opportunities identified</div>';
        }
        
        // Update recommendations
        function updateRecommendations() {
            const container = document.getElementById('recommendationsList');
            const recommendations = dashboardData.dashboard_metrics.predictive_analytics?.campaign_recommendations || [];
            
            if (recommendations.length === 0) {
                container.innerHTML = '<div class="text-center py-4">No recommendations at this time</div>';
                return;
            }
            
            const html = recommendations.map(rec => {
                const typeClass = `rec-${rec.type}`;
                const icon = rec.type === 'urgent' ? 'fas fa-exclamation-triangle' :
                           rec.type === 'warning' ? 'fas fa-exclamation-circle' :
                           rec.type === 'success' ? 'fas fa-check-circle' : 'fas fa-info-circle';
                
                return `
                    <div class="recommendation-item ${typeClass}">
                        <div class="d-flex align-items-start">
                            <i class="${icon} me-3 mt-1"></i>
                            <div>
                                <h6 class="mb-1">${rec.campaign}</h6>
                                <p class="mb-0">${rec.message}</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }
        
        // Campaign actions
        function viewCampaignDetails(campaignId) {
            // Open campaign details modal or redirect
            window.open(`/campaign-launcher?view=${campaignId}`, '_blank');
        }
        
        function optimizeCampaign(campaignId) {
            showNotification('Campaign optimization features coming soon!', 'info');
        }
        
        // Filter campaigns
        function filterCampaigns(filter) {
            // Update active filter button
            document.querySelectorAll('.btn-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Apply filter logic here
            showNotification(`Filter applied: ${filter}`, 'success');
        }
        
        // Export data
        function exportData() {
            const data = JSON.stringify(dashboardData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `campaign-performance-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('Data exported successfully', 'success');
        }
        
        // Refresh dashboard
        function refreshDashboard() {
            showNotification('Refreshing dashboard...', 'info');
            loadDashboardData();
        }
        
        // Auto-refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                loadDashboardData();
            }, 30000); // Refresh every 30 seconds
        }
        
        // Show notification
        function showNotification(message, type) {
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-danger' : 'alert-info';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 70px; right: 20px; z-index: 9999; max-width: 400px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        });
    </script>
</body>
</html>